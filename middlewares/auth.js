/*====================================================================================*/
/*  IMPORTACIONES
/*====================================================================================*/
const jwt = require('jsonwebtoken');
const SEED = require('../config/config').SEED;
/*====================================================================================*/
/*  VALIDACIÓN DEL TOKEN
/*====================================================================================*/
exports.verifyToken = (request, response, next) => {
  /*----------------------------------------------------------------------------------*/
  /* Se obtiene el token.
  /*----------------------------------------------------------------------------------*/
  const token = request.get('token');
  /*----------------------------------------------------------------------------------*/
  /* Se verifica la validez del token.
  /*----------------------------------------------------------------------------------*/
  jwt.verify(token, SEED, (error, decoded) => {
    /*--------------------------------------------------------------------------------*/
    /* Se maneja el error.
    /*--------------------------------------------------------------------------------*/
    if (error) {
      return response.status(401).json({
        ok: false,
        message: 'El token no es válido.',
        errors: error
      });
    }
    /*--------------------------------------------------------------------------------*/
    /* Se le asignan los datos del token al usuario.
    /*--------------------------------------------------------------------------------*/
    request.user = decoded.user;
    /*--------------------------------------------------------------------------------*/
    /* Se continúa con el proceso.
    /*--------------------------------------------------------------------------------*/
    next();
  });
};
