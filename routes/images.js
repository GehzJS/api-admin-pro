/*====================================================================================*/
/*  IMPORTACIONES
/*====================================================================================*/
const express = require('express');
const path = require('path');
const fileSystem = require('fs');
/*====================================================================================*/
/*  INICIALIZACIÓN DE VARIABLES
/*====================================================================================*/
const app = express();
/*====================================================================================*/
/*  DEFINICION DE RUTAS
/*====================================================================================*/
app.get('/:collection/:name', (request, response, next) => {
  /*----------------------------------------------------------------------------------*/
  /*  Se extrae el contenido de la petición.
  /*----------------------------------------------------------------------------------*/
  const collection = request.params.collection;
  const name = request.params.name;
  /*----------------------------------------------------------------------------------*/
  /*  Se realiza una búsqueda de la imagen.
  /*----------------------------------------------------------------------------------*/
  const image = path.resolve(__dirname, `../uploads/${collection}/${name}`);
  if (fileSystem.existsSync(image)) {
    /*--------------------------------------------------------------------------------*/
    /*  Se envía la imagen (si existe).
    /*--------------------------------------------------------------------------------*/
    response.send(image);
  } else {
    /*--------------------------------------------------------------------------------*/
    /*  Se envía la imagen por default (si no existe).
    /*--------------------------------------------------------------------------------*/
    const noImage = path.resolve(__dirname, '../assets/no_image.png');
    response.send(noImage);
  }
});
/*====================================================================================*/
/*  EXPORTACIÓN DEL MODULO
/*====================================================================================*/
module.exports = app;
